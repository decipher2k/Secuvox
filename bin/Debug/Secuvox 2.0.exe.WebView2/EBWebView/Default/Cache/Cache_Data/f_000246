{"version":3,"sources":["webpack://@cleverpush/cleverpush-js-sdk/./src/confirm/index.js","webpack://@cleverpush/cleverpush-js-sdk/./src/utils/topics.js"],"names":["CONFIRM_SELECTOR","BACKDROP_SELECTOR","CHECKED_TOPICS_AMOUNT_NEEDED","REGEX_NEW_LINES","REGEX_SPACE","CONFIRM_CLASS_PREFIX","Confirm","cleverpush","subscriptionManager","this","autoHideBackdrop","config","id","document","querySelectorAll","length","visible","channelTopics","filter","topic","show","matchPath","RegExp","test","window","parent","location","pathname","notMatchPath","facebookEnabled","facebookPageId","facebookCheckboxEnabled","facebookUserRef","storageManager","getFacebookUserRef","channelId","Math","random","toString","slice","addEventListener","hide","onTopicsAllowClick","bind","callback","bellResetCallback","type","i","NOTIFICATION_ACCESS_TYPES","isChromeOrChromium","x","y","padding","isFirefox","isEdge","innerWidth","class","deviceArrowConfig","text","textNode","querySelector","getBoundingClientRect","boundingRect","o","position","innerHeight","height","r","sqrt","pow","S","max","s","C","posX","posY","l","h","_","c","className","log","N","createNode","force","logMethodCall","boxes","getElementsByClassName","box","withTopics","indexOf","parentNode","removeChild","confirmBox","elem","hideBackdrop","removeConfirmBox","removeBrandingBox","e","preventDefault","selectedTopics","getSelectedTopics","hasTopics","hasTopicCheckboxes","confirmAlertRequireChannelTopics","confirmAlertSelectTopicsLater","alert","confirmAlertRequireChannelTopicsTitle","setClosed","iframeMessenger","err","triggerEvent","Event","isNewerEdge","allowCallback","undefined","showConfirmAlert","confirmAlertDouble","os","device","env","mobilePreview","appendDoubleBox","api","confirmAlertShown","existingPermission","backdrop","arrowNode","getArrowNode","appendChild","topics","topicIndex","checked","dataset","childTopicsRequired","childTopics","value","checkedChildTopics","childTopicIndex","innerText","trim","setTopics","sync","subscribeCallback","registerForPushLater","registerForPush","showUnblockTutorial","showBackdrop","translate","formatCleverPush","sessionStorage","setItem","showSilentPromptTutorial","confirmAlertHideArrow","shouldAppendNativeBox","ownDomain","protocol","hostname","confirmAlertNativeTheme","localStorage","nativePreview","getElementById","style","display","appendConfirmBox","subscribeCallbackCalled","detectPrompt","subscribe","subscribeForce","then","res","catch","setShowBackdrop","showSilentAlert","silentPromptTutorialDisabled","domain","contentSize","arrow","allowButton","onDoubleAllowClick","body","doubleBox","setDenied","showDenyAlert","topicId","event","onAllowClick","internal","confirm","topicChecked","map","_id","checkboxes","push","denyAlert","target","removeEventListener","onClickToCloseDenyAlertListener","onDenyAlertClick","getBrandingLinks","brandingBox","brandingBoxCloseButton","links","linkColor","confirmAlertThemeLinkColor","confirmAlertLinkStyle","color","brandingStyle","hideBranding","cleverpushDomain","brand","privacyPolicyUrl","privacyPolicyText","faqText","faqUrl","join","typeParam","errorMessage","hideNativeConfirmAlert","confirmAlertBackdrop","showBrandingBox","configAlertLocalization","alertLocalization","language","detectLanguage","alertLocalizationTranslations","backdropText","confirmAlertThemeTextColor","channelIcon","confirmAlertHideChannelIcon","channelName","charsetEscape","title","info","silentPromptOptInInputText","parser","UAParser","browser","getBrowser","name","platform","getOS","toLowerCase","replace","unblockImage","existingBackdrops","existingBackdrop","createElement","innerHTML","confirmAlertBackdropOpacity","backgroundColor","confirmAlertBackdropBlur","classList","add","renderCustomToolTip","fadeIn","permission","remove","includes","backdrops","backdropIndex","backdropNode","fadeOut","confirmConfig","customLocalization","topicsRequired","deny","allow","confirmInfo","nativeTitle","nativeText","moreInfo","moreButton","confirmAlertThemeParam","withTopicsParam","configParam","localization","getLocalization","confirmClass","confirmStyle","confirmAlertTheme","confirmAlertThemeVariant","confirmAlertStyle","confirmAlertThemeBackgroundColor","confirmAlertThemeBackground","confirmAlertCloseButton","topicSelection","parentContainer","topicsLayer","topicsTemplateFunction","confirmAlertHideChannelTopics","parentTopic","sort","a","b","forEach","topicName","topicDescription","description","childTopic","confirmAlertRadioButtonTopics","topicsRadioButtons","subscribedTopics","childTopicName","childInputType","childTopicsRadioButtons","appendConfirmBoxTo","showLinks","isNativeBox","Notification","isSafari_12_1","canHideTopics","showConfirmAlertMobile","confirmAlertSelectTopicsLaterDisabled","facebookButtonOptIn","facebookDoubleOptIn","facebookDoubleOptInConfirmed","origin","facebookAppId","confirmAlertSelectTopicsLaterTitle","confirmAlertSelectTopicsSaveText","infoStyle","fontSize","brandingLinks","topbarArrow","closeButton","iconClass","confirmAlertRoundChannelIcon","textStyle","titleStyle","confirmAlertThemeTitleColor","allowButtonStyleInline","confirmAlertThemeButtonTextColor","confirmAlertThemeButtonBackgroundColor","alertMoreInformationEnabled","property","hasOwnProperty","isNaN","confirmBoxTitle","confirmAlertTitleStyle","buttonStyle","confirmAlertButtonStyle","allowButtonStyle","confirmAlertAllowButtonStyle","ignored","customCss","marginLeft","Object","keys","confirmAlertIconStyle","icon","width","margin","setProperty","borderColor","camelCaseToDash","denyButton","onTopicsDenyClick","onDenyClick","onCloseClick","moreDiv","childTopicInput","find","topicsDiv","templateFunc","eval","getTopics","selectedTopicIds","defaultUnchecked","matchPathChecked"],"mappings":"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","file":"chunk/720.da266ba8d9bc4aa9c01f.js","sourcesContent":["import UAParser from 'ua-parser-js';\n\nimport { log, logMethodCall } from '../utils/debug';\nimport { createNode, fadeIn, fadeOut } from '../utils/dom';\nimport { translate, charsetEscape, detectLanguage } from '../utils/translate';\nimport { topicChecked } from '../utils/topics';\nimport { detectPrompt } from '../utils/detect';\nimport { camelCaseToDash } from '../utils/strings';\nimport Event from '../const/event';\nimport './confirm.scss';\n\nimport {\n  os,\n  device,\n  NOTIFICATION_ACCESS_TYPES,\n  isNewerEdge,\n  isChromeOrChromium,\n  isEdge,\n  isFirefox\n} from '../utils/env';\n\nconst CONFIRM_SELECTOR = '.cleverpush-confirm';\nconst BACKDROP_SELECTOR = '.cleverpush-backdrop';\nconst CHECKED_TOPICS_AMOUNT_NEEDED = 0;\nconst REGEX_NEW_LINES = /\\r?\\n|\\r/g;\nconst REGEX_SPACE = /\\s/g;\nconst CONFIRM_CLASS_PREFIX = 'cleverpush-confirm';\n\nexport default class Confirm {\n  constructor(cleverpush, subscriptionManager) {\n    this.autoHideBackdrop = true;\n    this.cleverpush = cleverpush;\n    this.config = cleverpush.config;\n    this.subscriptionManager = subscriptionManager;\n    this.id = document.querySelectorAll(CONFIRM_SELECTOR).length + 1;\n    this.visible = false;\n    this.channelTopics = (this.config.channelTopics || []).filter((topic) => {\n      let show = true;\n      if (show && topic.matchPath && topic.matchPath.length) {\n        show = new RegExp(topic.matchPath).test(window.parent.location.pathname);\n      }\n      if (show && topic.notMatchPath && topic.notMatchPath.length) {\n        show = !(new RegExp(topic.notMatchPath).test(window.parent.location.pathname));\n      }\n      return show;\n    });\n\n    this.facebookEnabled = false;\n    if (this.config.facebookPageId && this.config.facebookPageId.length && this.config.facebookCheckboxEnabled) {\n      this.facebookEnabled = true;\n      // generate an unique user reference\n      this.facebookUserRef = this.subscriptionManager.storageManager.getFacebookUserRef();\n      if (!this.facebookUserRef) {\n        this.facebookUserRef = `${this.config.channelId}-`;\n        this.facebookUserRef += Math.random().toString(36).slice(2);\n      }\n    }\n\n    window.addEventListener('beforeunload', () => {\n      this.autoHideBackdrop = true;\n      this.hide();\n    });\n\n    this.onTopicsAllowClick = this.onTopicsAllowClick.bind(this);\n  }\n\n  resetBell(callback) {\n    if (typeof callback === 'function') {\n      this.bellResetCallback = callback;\n    }\n  }\n\n  getArrowNode(type, config) {\n    const deviceArrowConfig = () => {\n      if (type === NOTIFICATION_ACCESS_TYPES.GRANT) {\n        if (isChromeOrChromium()) {\n          return {\n            x: 347,\n            y: 92,\n            padding: 20\n          };\n        }\n        if (isFirefox()) {\n          return {\n            x: 311,\n            y: 148,\n            padding: 20\n          };\n        }\n      }\n      if (type === NOTIFICATION_ACCESS_TYPES.DENIED) {\n        if (isChromeOrChromium()) {\n          return {\n            x: 131,\n            y: 0,\n            padding: 0\n          };\n        }\n        if (isFirefox()) {\n          return {\n            x: 60,\n            y: 0,\n            padding: 0\n          };\n        }\n      } else if (type === NOTIFICATION_ACCESS_TYPES.SILENT) {\n        if (isChromeOrChromium() || isEdge()) {\n          return {\n            x: window.innerWidth - 250,\n            y: 0,\n            padding: 0,\n            class: 'reverse-arrow'\n          };\n        }\n      }\n\n      return null;\n    };\n\n    const i = type === 'own' ? config : ({ ...deviceArrowConfig(), ...config || {} });\n    if (!i) {\n      return null;\n    }\n    const text = i.textNode || document.querySelector('.cleverpush-backdrop-text h2');\n    if (text && text.getBoundingClientRect) {\n      const boundingRect = text.getBoundingClientRect();\n      const o = i.position || {\n        x: (window.innerWidth) / 2,\n        y: (window.innerHeight - boundingRect.height) / 2\n      };\n      const r = Math.sqrt(Math.pow(i.x - o.x, 2) + Math.pow(i.y - o.y, 2));\n      const S = Math.max(0.1 * r, 15);\n      const s = i.x;\n      const C = i.y + S + i.padding;\n      const posX = o.x - 15;\n      const posY = Math.max(o.y + 20 + boundingRect.height, C + 40);\n      const l = posX - s;\n      const h = posY - C;\n      const _ = `M ${posX} ${posY} q ${-1 * l} ${h}, ${-1 * l} ${-1 * h}`;\n      const c = `M ${s - S} ${C + S} q ${S} ${-3 * S}, ${2 * S} 0`;\n      const className = (!!i.class && i.class) || 'cp-arrow';\n\n      log.info('getArrowNode', {\n        type,\n        i,\n        o,\n        r,\n        S,\n        s,\n        C,\n        posX,\n        posY,\n        l,\n        h,\n        _,\n        c\n      });\n\n      const N = `\n      <div class=\"cleverpush-backdrop-arrow\">\n        <svg \n          width=\"${window.innerWidth}px\"\n          height=\"${window.innerHeight}px\"\n          class=${className}\n          viewBox=\"0 0 ${window.innerWidth} ${window.innerHeight}\"\n          version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\"\n        >\n            <g stroke-width=\"5\" stroke-linecap=\"round\" fill=\"none\" fill-rule=\"evenodd\">\n              <path d=\"${_}\" id=\"tail\" stroke=\"#FFFFFF\"></path><path d=\"${c}\" id=\"head\" stroke=\"#FFFFFF\"></path>\n            </g>\n         </svg>\n        </div>\n       </div>`;\n      return createNode(N);\n    }\n  }\n\n  removeConfirmBox(force = false) {\n    logMethodCall('removeConfirmBox');\n\n    this.visible = false;\n    const boxes = document.getElementsByClassName(CONFIRM_CLASS_PREFIX);\n    if (boxes.length) {\n      const box = boxes[boxes.length - 1];\n      if (force || ((!this.withTopics || box.className.indexOf('cleverpush-topic-box') < 0) && box.className.indexOf('cleverpush-attributes-box') < 0)) {\n        box.parentNode.removeChild(box);\n      }\n    }\n\n    this.confirmBox = null;\n  }\n\n  removeBrandingBox() {\n    logMethodCall('removeBrandingBox');\n\n    this.visible = false;\n    const boxes = document.getElementsByClassName('cleverpush-branding-box');\n    if (boxes.length) {\n      const elem = boxes[boxes.length - 1];\n      elem.parentNode.removeChild(elem);\n    }\n  }\n\n  hide(force = false) {\n    logMethodCall('hide');\n\n    if (this.autoHideBackdrop) {\n      this.hideBackdrop();\n    }\n    this.removeConfirmBox(force);\n    this.removeBrandingBox();\n  }\n\n  onCloseClick(e) {\n    logMethodCall('closeConfirmBox');\n\n    e.preventDefault();\n\n    const selectedTopics = this.getSelectedTopics();\n    const hasTopics = this.hasTopicCheckboxes(true);\n    if (this.config.confirmAlertRequireChannelTopics && !selectedTopics.length && hasTopics && this.withTopics && this.config.confirmAlertSelectTopicsLater) {\n      alert(this.config.confirmAlertRequireChannelTopicsTitle || 'Bitte wähle mindestens eine Kategorie aus.');\n      return;\n    }\n\n    this.hide(true);\n    this.hideBackdrop();\n\n    try {\n      this.subscriptionManager.storageManager.setClosed();\n      if (this.subscriptionManager.iframeMessenger && this.subscriptionManager.iframeMessenger.setClosed) {\n        this.subscriptionManager.iframeMessenger.setClosed();\n      }\n    } catch (err) {\n      log.error(err);\n    }\n\n    this.subscriptionManager.triggerEvent(Event.OPTIN_CLOSED);\n  }\n\n  onAllowClick(e) {\n    logMethodCall('onAllowClick');\n\n    e.preventDefault();\n\n    const selectedTopics = this.getSelectedTopics();\n    const hasTopics = this.hasTopicCheckboxes(true);\n\n    if (isNewerEdge()) {\n      this.hideBackdrop();\n    }\n\n    if (this.config.confirmAlertRequireChannelTopics && !selectedTopics.length && hasTopics && (this.withTopics || !this.config.confirmAlertSelectTopicsLater)) {\n      alert(this.config.confirmAlertRequireChannelTopicsTitle || 'Bitte wähle mindestens eine Kategorie aus.');\n      return;\n    }\n\n    if (typeof this.allowCallback === 'function') {\n      this.allowCallback(true, selectedTopics);\n      this.allowCallback = undefined;\n\n      if (!this.withTopics) {\n        this.hide();\n        return;\n      }\n    }\n\n    if (!this.withTopics && this.config.showConfirmAlert && this.config.confirmAlertDouble) {\n      if (os.name === 'Android' || device.type === 'mobile' || (this.config.env === 'PREVIEW' && this.config.mobilePreview)) {\n        this.hide();\n        this.hideBackdrop();\n        this.appendDoubleBox();\n\n        // track the confirm of the first step\n        this.subscriptionManager.api.confirmAlertShown(this.subscriptionManager.existingPermission, 'confirm');\n        return;\n      }\n      const backdrop = document.querySelector(BACKDROP_SELECTOR);\n      if (backdrop) {\n        const arrowNode = this.getArrowNode('grant', {\n          textNode: {},\n          position: {\n            x: window.innerWidth / 2,\n            y: window.innerHeight / 2\n          }\n        });\n        if (arrowNode) {\n          backdrop.appendChild(arrowNode);\n        }\n      }\n    }\n\n    if (!this.confirmBox) {\n      this.confirmBox = document.querySelector(`.${CONFIRM_CLASS_PREFIX}-${this.id}`);\n    }\n    if (this.confirmBox) {\n      const topics = this.confirmBox.querySelectorAll('input[name=\"topics[]\"]');\n      for (let topicIndex = 0; topicIndex < topics.length; topicIndex += 1) {\n        if (topics[topicIndex].checked && topics[topicIndex].dataset && topics[topicIndex].dataset.childTopicsRequired === 'true') {\n          const childTopics = this.confirmBox.querySelectorAll(`.topic-child[data-parent-topic=\"${topics[topicIndex].value}\"] input`);\n          if (childTopics.length) {\n            let checkedChildTopics = 0;\n            for (let childTopicIndex = 0; childTopicIndex < childTopics.length; childTopicIndex += 1) {\n              if (childTopics[childTopicIndex].checked) {\n                checkedChildTopics += 1;\n              }\n            }\n            if (checkedChildTopics === CHECKED_TOPICS_AMOUNT_NEEDED) {\n              alert(`Bitte wähle mindestens eine Kategorie in ${(topics[topicIndex].parentNode.innerText || '').trim()} aus.`);\n              return;\n            }\n          }\n        }\n      }\n    }\n\n    this.subscriptionManager.setTopics(selectedTopics);\n\n    if (this.withTopics && this.config.confirmAlertSelectTopicsLater && hasTopics) {\n      this.subscriptionManager.sync();\n      this.withTopics = false;\n      this.hide();\n      if (this.subscribeCallback) {\n        this.subscribeCallback(false);\n      }\n\n      if (this.subscriptionManager.registerForPushLater) {\n        this.subscriptionManager.registerForPush();\n      }\n\n      this.subscriptionManager.triggerEvent(Event.TOPICS_MANUALLY_SAVED);\n\n      return;\n    }\n\n    if (this.config.showUnblockTutorial) {\n      this.hide();\n\n      this.showBackdrop(undefined, 'denied', translate('popup.info').formatCleverPush(`<strong>${translate('confirm.allowBrowser') || translate('confirm.allow')}</strong>`));\n\n      try {\n        sessionStorage.setItem('cleverpush-subscription-status', 'denied');\n      } catch (e) { }\n\n      return;\n    }\n\n    if (this.config.showSilentPromptTutorial) {\n      this.hide();\n\n      this.config.confirmAlertHideArrow = false;\n      this.showBackdrop(undefined, 'silentPrompt', translate('confirm.silentPromptInfo'));\n    }\n\n    // show native confirm box\n    let shouldAppendNativeBox = false;\n    if (this.config.ownDomain && (window.parent.location.protocol === 'https:' || window.parent.location.hostname === 'localhost') && this.config.showConfirmAlert) {\n      if (this.config.confirmAlertNativeTheme && this.config.confirmAlertNativeTheme !== 'cleverpush-confirm-default' && this.config.confirmAlertNativeTheme !== 'cleverpush-confirm-backdrop-text') {\n        this.removeConfirmBox();\n        shouldAppendNativeBox = true;\n      } else {\n        this.hide();\n      }\n\n      // track the confirm of the first step\n      this.subscriptionManager.api.confirmAlertShown(this.subscriptionManager.existingPermission, 'confirm');\n    } else {\n      this.hide();\n    }\n\n    localStorage.setItem('cleverpush-subscription-status', 'allowed');\n\n    if (this.config.env === 'PREVIEW') {\n      const nativePreview = document.getElementById('cleverpush-preview-native');\n      if (nativePreview) {\n        nativePreview.style.display = 'block';\n\n        if (shouldAppendNativeBox) {\n          this.appendConfirmBox(`${this.config.confirmAlertNativeTheme} ${this.config.confirmAlertNativeTheme}-native`);\n        }\n\n        return;\n      }\n    }\n\n    let subscribeCallbackCalled = false;\n    let showBackdrop;\n\n    detectPrompt({\n      subscriptionManager: this.subscriptionManager,\n      config: this.config,\n      subscribe: () => {\n        this.subscriptionManager.subscribeForce(false).then((res) => {\n          subscribeCallbackCalled = true;\n          this.hideBackdrop();\n          if (this.subscribeCallback) {\n            this.subscribeCallback(false, res);\n          }\n        }).catch((err) => {\n          subscribeCallbackCalled = true;\n          this.hideBackdrop();\n          if (this.subscribeCallback) {\n            this.subscribeCallback(err);\n          }\n        });\n      },\n      showBackdrop: () => {\n        if (shouldAppendNativeBox) {\n          this.appendConfirmBox(`${this.config.confirmAlertNativeTheme} ${this.config.confirmAlertNativeTheme}-native`);\n        }\n      },\n      setShowBackdrop: (backdrop) => showBackdrop = backdrop,\n      showSilentAlert: () => {\n        if (!subscribeCallbackCalled && !this.config.silentPromptTutorialDisabled) {\n          this.hide();\n\n          this.config.confirmAlertHideArrow = false;\n          this.showBackdrop(undefined, 'silentPrompt', translate('confirm.silentPromptInfo'));\n        }\n      },\n    });\n\n    this.subscriptionManager.triggerEvent(Event.OPTIN_ALLOWED);\n  }\n\n  appendDoubleBox() {\n    const box = createNode(\n      `\n      <div class=\"${CONFIRM_CLASS_PREFIX}-double ${CONFIRM_CLASS_PREFIX}-double-${this.id}\">\n        <div class=\"${CONFIRM_CLASS_PREFIX}-double-above\">\n          ${translate('confirm.doubleText').formatCleverPush(`<strong>${translate('confirm.allowBrowser') || translate('confirm.allow')}</strong>`)}\n        </div>\n        <div class=\"${CONFIRM_CLASS_PREFIX}-double-content\">\n          <div class=\"${CONFIRM_CLASS_PREFIX}-double-text\">\n            <div class=\"${CONFIRM_CLASS_PREFIX}-double-bell\">\n              <svg height=\"512pt\" viewBox=\"-21 0 512 512\" width=\"512pt\" xmlns=\"http://www.w3.org/2000/svg\">\n              <path d=\"m434.753906 360.8125c-32.257812-27.265625-50.753906-67.117188-50.753906-109.335938v-59.476562c0-75.070312-55.765625-137.214844-128-147.625v-23.042969c0-11.796875-9.558594-21.332031-21.332031-21.332031-11.777344 0-21.335938 9.535156-21.335938 21.332031v23.042969c-72.253906 10.410156-128 72.554688-128 147.625v59.476562c0 42.21875-18.496093 82.070313-50.941406 109.503907-8.300781 7.105469-13.058594 17.429687-13.058594 28.351562 0 20.589844 16.746094 37.335938 37.335938 37.335938h352c20.585937 0 37.332031-16.746094 37.332031-37.335938 0-10.921875-4.757812-21.246093-13.246094-28.519531zm0 0\"/><path d=\"m234.667969 512c38.632812 0 70.953125-27.542969 78.378906-64h-156.757813c7.421876 36.457031 39.742188 64 78.378907 64zm0 0\"/></svg>\n            </div>\n            <div class=\"${CONFIRM_CLASS_PREFIX}-double-title\">${translate('confirm.nativeTitle').formatCleverPush(location.hostname || this.config.domain)}</div>\n          </div>\n          <div class=\"${CONFIRM_CLASS_PREFIX}-double-buttons\">\n            <button type=\"button\" class=\"${CONFIRM_CLASS_PREFIX}-double-btn\">${(translate('confirm.allowBrowser') || translate('confirm.allow'))}</button>\n          </div>\n        </div>\n        <div class=\"${CONFIRM_CLASS_PREFIX}-double-below\">\n          <div class=\"${CONFIRM_CLASS_PREFIX}-double-arrow\"></div>\n        </div>\n      </div>\n      `\n    );\n\n    const content = box.querySelector('.cleverpush-confirm-double-content');\n    const contentSize = content.getBoundingClientRect();\n\n    const arrow = box.querySelector('.cleverpush-confirm-double-arrow');\n    if (arrow) {\n      const arrowNode = this.getArrowNode('own', {\n        x: window.innerWidth - 55,\n        y: (window.innerHeight / 2) + (contentSize.height / 2) + 65,\n        padding: 0,\n        textNode: box.querySelector('.cleverpush-confirm-double-below')\n      });\n      if (arrowNode) {\n        arrow.appendChild(arrowNode);\n      }\n    }\n\n    const allowButton = box.querySelector('.cleverpush-confirm-double-btn');\n    if (allowButton) {\n      allowButton.addEventListener('click', this.onDoubleAllowClick.bind(this));\n    }\n\n    document.body.appendChild(box);\n\n    this.doubleBox = document.body.querySelector('.cleverpush-confirm-double');\n  }\n\n  onDoubleAllowClick(e) {\n    e.preventDefault();\n    logMethodCall('onDoubleAllowClick');\n\n    if (this.doubleBox) {\n      this.doubleBox.parentNode.removeChild(this.doubleBox);\n    }\n\n    this.subscriptionManager.subscribeForce(false).then((res) => {\n      this.hideBackdrop();\n      if (this.subscribeCallback) {\n        this.subscribeCallback(false, res);\n      }\n    }).catch((err) => {\n      this.hideBackdrop();\n      if (this.subscribeCallback) {\n        this.subscribeCallback(err);\n      }\n    });\n  }\n\n  /**\n   * Triggered when user clicks on 'Deny' in confirm layer\n   * @param {Event} e Click Event\n   */\n  onDenyClick(e) {\n    logMethodCall('denyPush');\n\n    e.preventDefault();\n\n    try {\n      if (this.config.env !== 'PREVIEW') {\n        this.subscriptionManager.storageManager.setDenied();\n        if (this.subscriptionManager.iframeMessenger && this.subscriptionManager.iframeMessenger.setDenied) {\n          this.subscriptionManager.iframeMessenger.setDenied();\n        }\n      }\n    } catch (err) {\n      log.error(err);\n    }\n\n    this.autoHideBackdrop = true;\n    this.hide();\n\n    if (this.config.ownDomain && (window.parent.location.protocol === 'https:' || window.parent.location.hostname === 'localhost')) {\n      this.showDenyAlert();\n    }\n\n    if (typeof this.allowCallback === 'function') {\n      this.allowCallback(false, []);\n      this.allowCallback = undefined;\n    }\n\n    this.subscriptionManager.triggerEvent(Event.OPTIN_DENIED);\n  }\n\n  /**\n   * Triggered when user clicks on 'Deny' in topics layer\n   * @param {Event} e Click Event\n   */\n  onTopicsDenyClick(e, topicId) {\n    logMethodCall('denyPush');\n\n    e.preventDefault();\n\n    this.autoHideBackdrop = true;\n    this.hide();\n\n    if (typeof this.allowCallback === 'function') {\n      this.allowCallback(false, []);\n      this.allowCallback = undefined;\n    }\n\n    this.subscriptionManager.triggerEvent(Event.TOPICS_LAYER_DENIED, topicId);\n  }\n\n  onTopicsAllowClick(event, topicId) {\n    this.onAllowClick(event);\n\n    this.subscriptionManager.triggerEvent(Event.TOPICS_LAYER_ALLOWED, topicId);\n  }\n\n  hasTopicCheckboxes(internal) {\n    logMethodCall('hasTopicCheckboxes');\n\n    if (this.config.confirmAlertSelectTopicsLater && !this.withTopics && typeof internal === 'undefined') {\n      // used to initially set all pre-checked topics\n      return true;\n    }\n\n    const confirm = document.querySelector(CONFIRM_SELECTOR);\n    if (confirm) {\n      const checkboxes = confirm.querySelectorAll('input[name=\"topics[]\"]');\n      return checkboxes.length > 0;\n    }\n\n    return false;\n  }\n\n  getSelectedTopics() {\n    logMethodCall('getSelectedTopics');\n\n    // by default, return all pre-checked topics\n    let topics = (this.channelTopics || []).filter(topicChecked).map((topic) => topic._id);\n\n    const confirm = document.querySelector(CONFIRM_SELECTOR);\n    if (confirm) {\n      const checkboxes = confirm.querySelectorAll('input[name=\"topics[]\"]');\n      if (checkboxes && checkboxes.length) {\n        topics = [];\n        for (let i = 0; i < checkboxes.length; i += 1) {\n          if ((checkboxes[i].type === 'checkbox' || checkboxes[i].type === 'radio') && checkboxes[i].checked) {\n            topics.push(checkboxes[i].value);\n          }\n        }\n      }\n    }\n\n    return topics;\n  }\n\n  showDenyAlert() {\n    logMethodCall('showDenyAlert');\n  }\n\n  onClickToCloseDenyAlert(e) {\n    if (this.denyAlert && e.target !== this.denyAlert && e.target.parentNode !== this.denyAlert) {\n      document.removeEventListener('click', this.onClickToCloseDenyAlertListener);\n\n      this.onDenyAlertClick();\n    }\n  }\n\n  onDenyAlertClick(e) {\n    if (typeof e !== 'undefined') {\n      e.preventDefault();\n    }\n\n    logMethodCall('onDenyAlertClick');\n\n    const elem = document.getElementsByClassName('cleverpush-deny-alert')[0];\n    elem.parentNode.removeChild(elem);\n\n    this.denyAlert = null;\n  }\n\n  showBrandingBox() {\n    logMethodCall('showBrandingBox');\n\n    document.body.appendChild(createNode(\n      `<div class=\"cleverpush-branding-box cleverpush-branding-box-${this.id}\"><div class=\"cleverpush-branding-box-text\">${this.getBrandingLinks()}</div><button class=\"cleverpush-branding-box-close\">&times;</button></div>`,\n    ));\n\n    this.brandingBox = document.querySelector(`.cleverpush-branding-box-${this.id}`);\n\n    this.brandingBoxCloseButton = this.brandingBox.querySelector('.cleverpush-branding-box-close');\n    if (this.brandingBoxCloseButton) {\n      this.brandingBoxCloseButton.addEventListener('click', this.removeBrandingBox.bind(this));\n    }\n  }\n\n  getBrandingLinks() {\n    const links = [];\n\n    let linkColor = this.config.confirmAlertThemeLinkColor;\n    if (this.config.confirmAlertLinkStyle && this.config.confirmAlertLinkStyle.color) {\n      linkColor = this.config.confirmAlertLinkStyle.color;\n    }\n    const brandingStyle = linkColor ? (`color: ${linkColor} !important`) : '';\n\n    if (!this.config.hideBranding) {\n      let domain = this.config.cleverpushDomain || 'cleverpush.com';\n      if (domain === 'mycleverpush.com') {\n        domain = 'cleverpush.com';\n      }\n      let brand = 'CleverPush';\n      if (domain === 'convertpush.io') {\n        brand = 'ConvertPush';\n      }\n      links.push(`<a href=\"https://${domain}/\" target=\"_blank\" style=\"${brandingStyle}\">Powered by ${brand}</a>`);\n    }\n    if (this.config.privacyPolicyUrl) {\n      links.push(`<a href=\"${this.config.privacyPolicyUrl}\" target=\"_blank\" style=\"${brandingStyle}\">${this.config.privacyPolicyText || translate('privacy')}</a>`);\n    }\n    if (this.config.faqText && this.config.faqUrl) {\n      links.push(`<a href=\"${this.config.faqUrl}\" target=\"_blank\" style=\"${brandingStyle}\">${this.config.faqText || 'FAQ'}</a>`);\n    }\n\n    return links.join(' &nbsp;/&nbsp; ');\n  }\n\n  showBackdrop(callback, typeParam, errorMessage) {\n    logMethodCall('showBackdrop');\n\n    let type = 'grant';\n    if (typeof typeParam !== 'undefined') {\n      if (typeParam === 'denied' || typeParam === 'silentPrompt') {\n        type = typeParam;\n      }\n    }\n\n    if (\n      type !== 'denied'\n      && type !== 'silentPrompt'\n      && !this.config.hideNativeConfirmAlert\n      && !this.config.showConfirmAlert\n      && (\n        this.config.confirmAlertNativeTheme\n        && this.config.confirmAlertNativeTheme !== 'cleverpush-confirm-default'\n        && this.config.confirmAlertNativeTheme !== 'cleverpush-confirm-backdrop-text'\n      )\n      && this.config.ownDomain\n      && (window.parent.location.protocol === 'https:' || window.parent.location.hostname === 'localhost')\n    ) {\n      log.debug('appending native backdrop', this.config.showConfirmAlert);\n      this.appendConfirmBox(`${this.config.confirmAlertNativeTheme} ${this.config.confirmAlertNativeTheme}-native`);\n    }\n\n    if (\n      !this.config.confirmAlertBackdrop\n      && !this.config.showConfirmAlert\n      && (!this.config.confirmAlertNativeTheme || this.config.confirmAlertNativeTheme === 'cleverpush-confirm-default')\n      && !this.config.hideBranding\n    ) {\n      this.showBrandingBox();\n    }\n\n    if (\n      type !== 'denied'\n      && type !== 'silentPrompt'\n      && (typeof this.config.confirmAlertBackdrop !== 'undefined' && !this.config.confirmAlertBackdrop)\n    ) {\n      if (typeof callback === 'function') {\n        callback();\n      }\n      return;\n    }\n\n    let configAlertLocalization = this.config.alertLocalization || {};\n    const language = detectLanguage(this.config || {});\n    if (this.config.alertLocalizationTranslations && language && this.config.alertLocalizationTranslations[language]) {\n      configAlertLocalization = { ...configAlertLocalization, ...this.config.alertLocalizationTranslations[language] };\n    }\n\n    let backdropText = '';\n    if (\n      this.config.ownDomain\n      && (window.parent.location.protocol === 'https:' || window.parent.location.hostname === 'localhost')\n    ) {\n      if (\n        type === 'denied'\n        || type === 'silentPrompt'\n        || this.config.confirmAlertNativeTheme === 'cleverpush-confirm-backdrop-text'\n      ) {\n        if (type === 'grant') {\n          backdropText += `<div class=\"cleverpush-backdrop-text\" style=\"${this.config.confirmAlertThemeTextColor ? (`color: ${this.config.confirmAlertThemeTextColor}`) : ''}\">\n${this.config.channelIcon && !this.config.confirmAlertHideChannelIcon ? `<p class=\"cleverpush-backdrop-icon\"><img src=\"${this.config.channelIcon}\" alt=\"${this.config.channelName}\"></p>` : ''}\n<h2>${charsetEscape(configAlertLocalization.title) || translate('popup.info').formatCleverPush(`<strong>${translate('confirm.allowBrowser') || translate('confirm.allow')}</strong>`)}</h2>\n<p>${charsetEscape(configAlertLocalization.info) || translate('popup.text').formatCleverPush(`<strong>${this.config.channelName}</strong>`)}</p>\n</div>`;\n        } else if (type === 'silentPrompt') {\n          backdropText += `<div class=\"cleverpush-backdrop-text\"><h2>${configAlertLocalization.silentPromptOptInInputText || errorMessage}</h2></div>`;\n        } else {\n          const parser = new UAParser();\n          let { name: browser } = parser.getBrowser();\n          let { name: platform } = parser.getOS();\n          browser = browser.toLowerCase().replace(/\\s/g, '').replace('chromium', 'chrome').replace('edge', 'chrome');\n          platform = platform.toLowerCase().replace(/\\s/g, '').replace('macos', 'mac');\n\n          let unblockImage = '';\n          if ((browser === 'chrome' || browser === 'firefox' || browser === 'safari') && (platform === 'android' || platform === 'windows' || platform === 'mac')) {\n            if (browser === 'chrome' && platform === 'android') {\n              unblockImage = `<div><video src=\"https://static.cleverpush.com/app/images/unblock-tutorial/${browser}-${platform}.mp4\" width=\"100%\" autoplay loop muted playsinline /></div>`;\n            } else {\n              unblockImage = `<div><img src=\"https://static.cleverpush.com/app/images/unblock-tutorial/${browser}-${platform}.gif\" /></div>`;\n            }\n          }\n\n          backdropText += `<div class=\"cleverpush-backdrop-text\"><h2>${unblockImage ? translate('unblock.title') : errorMessage}</h2>${unblockImage}</div>`;\n        }\n      }\n    }\n\n    const existingBackdrops = document.getElementsByClassName('cleverpush-backdrop');\n    if (existingBackdrops && existingBackdrops.length) {\n      for (let i = 0; i < existingBackdrops.length; i += 1) {\n        const existingBackdrop = existingBackdrops[i];\n        if (existingBackdrop && existingBackdrop.parentNode) {\n          existingBackdrop.parentNode.removeChild(existingBackdrop);\n        }\n      }\n    }\n\n    const backdrop = document.createElement('div');\n    backdrop.className = `cleverpush-backdrop cleverpush-backdrop-${type}`;\n    backdrop.style.display = 'none';\n    backdrop.innerHTML = backdropText;\n\n    if (this.config.confirmAlertBackdropOpacity && type !== 'denied' && type !== 'silentPrompt') {\n      backdrop.style.backgroundColor = `rgba(0, 0, 0, ${this.config.confirmAlertBackdropOpacity})`;\n    }\n    if (this.config.confirmAlertBackdropBlur) {\n      backdrop.className += ' cleverpush-backdrop-blur';\n    }\n\n    // remove backdrop on click\n    backdrop.addEventListener('click', (e) => {\n      e.preventDefault();\n      this.hideBackdrop(type);\n    });\n\n    if (document.body) {\n      document.body.appendChild(backdrop);\n\n      if (document.body.classList) {\n        document.body.classList.add('has-cleverpush-backdrop');\n        if (this.config.confirmAlertBackdropBlur) {\n          document.body.classList.add('has-cleverpush-backdrop-blur');\n        }\n      } else {\n        document.body.className += ' has-cleverpush-backdrop';\n        if (this.config.confirmAlertBackdropBlur) {\n          document.body.className += ' has-cleverpush-backdrop-blur';\n        }\n      }\n    }\n\n    if (typeof window.renderCustomToolTip === 'function' && backdropText) {\n      window.renderCustomToolTip(backdrop);\n      fadeIn(backdrop, 200, typeof callback !== 'undefined' ? callback : () => { });\n      return;\n    }\n\n    if (backdropText && backdropText.length && !this.config.confirmAlertHideArrow) {\n      const arrowNode = this.getArrowNode(type);\n      if (arrowNode) {\n        backdrop.appendChild(arrowNode);\n      }\n    }\n\n    fadeIn(backdrop, 200, typeof callback !== 'undefined' ? callback : () => { });\n  }\n\n  hideBackdrop(permission) {\n    logMethodCall('hideBackdrop');\n\n    this.removeBrandingBox();\n\n    if (document.body) {\n      if (document.body.classList) {\n        if (this.config.confirmAlertBackdropBlur) {\n          document.body.classList.remove('has-cleverpush-backdrop-blur');\n        }\n        document.body.classList.remove('has-cleverpush-backdrop');\n      } else {\n        if (this.config.confirmAlertBackdropBlur) {\n          document.body.className = document.body.className.replace('has-cleverpush-backdrop-blur', '');\n        }\n        document.body.className = document.body.className.replace('has-cleverpush-backdrop', '');\n      }\n    }\n\n    if (\n      !this.config.hideNativeConfirmAlert\n      && (this.config.confirmAlertNativeTheme\n        && this.config.confirmAlertNativeTheme !== 'cleverpush-confirm-default'\n        && this.config.confirmAlertNativeTheme !== 'cleverpush-backdrop-text')\n      && this.confirmBox\n      && this.confirmBox.className.includes(`${this.config.confirmAlertNativeTheme}-native`)\n    ) {\n      this.removeConfirmBox();\n    }\n\n    if ((typeof permission === 'undefined' || permission !== 'denied') && typeof this.config.confirmAlertBackdrop !== 'undefined' && !this.config.confirmAlertBackdrop && !this.config.showSilentPromptTutorial) {\n      return;\n    }\n\n    if (typeof this.bellResetCallback === 'function' && (typeof permission === 'undefined' || permission === 'grant')) {\n      this.bellResetCallback(false);\n      this.bellResetCallback = undefined;\n    }\n\n    const backdrops = document.getElementsByClassName('cleverpush-backdrop');\n    for (let backdropIndex = 0; backdropIndex < backdrops.length; backdropIndex += 1) {\n      const backdrop = backdrops[backdropIndex];\n      ((backdropNode) => {\n        fadeOut(backdropNode, 200, () => {\n          if (backdropNode && backdropNode.parentNode) {\n            backdropNode.parentNode.removeChild(backdropNode);\n          }\n        });\n      })(backdrop);\n    }\n  }\n\n  getLocalization(confirmConfig) {\n    let configAlertLocalization = this.config.alertLocalization || {};\n    const language = detectLanguage(this.config || {});\n    if (this.config.alertLocalizationTranslations && language && this.config.alertLocalizationTranslations[language]) {\n      configAlertLocalization = { ...configAlertLocalization, ...this.config.alertLocalizationTranslations[language] };\n    }\n\n    configAlertLocalization = { ...configAlertLocalization, ...confirmConfig.customLocalization };\n\n    if (confirmConfig.topicsRequired) {\n      this.config.confirmAlertRequireChannelTopics = true;\n    }\n\n    const localization = {\n      title: charsetEscape(configAlertLocalization.title) || translate('confirm.title').formatCleverPush(this.config.channelName),\n      info: charsetEscape(configAlertLocalization.info) || translate('confirm.info'),\n      deny: charsetEscape(configAlertLocalization.deny) || translate('confirm.deny'),\n      allow: charsetEscape(configAlertLocalization.allow) || translate('confirm.allow'),\n      confirmInfo: charsetEscape(configAlertLocalization.confirmInfo) || translate('popup.info').formatCleverPush(translate('confirm.allowBrowser')),\n      nativeTitle: charsetEscape(configAlertLocalization.nativeTitle),\n      nativeText: charsetEscape(configAlertLocalization.nativeText),\n      moreInfo: charsetEscape(configAlertLocalization.moreInfo),\n      moreButton: charsetEscape(configAlertLocalization.moreButton) || translate('confirm.more'),\n    };\n\n    return localization;\n  }\n\n  appendConfirmBox(confirmAlertThemeParam, withTopicsParam, configParam, allowCallback) {\n    logMethodCall('appendConfirmBox', confirmAlertThemeParam, withTopicsParam, configParam);\n\n    if (this.confirmBox) {\n      // already appended\n      return;\n    }\n\n    this.withTopics = typeof withTopicsParam === 'boolean' && withTopicsParam;\n\n    if (this.withTopics && document.querySelector('.cleverpush-topic-box')) {\n      // already appended\n      return;\n    }\n\n    if (typeof allowCallback === 'function') {\n      this.allowCallback = allowCallback;\n    }\n\n    const confirmConfig = typeof configParam === 'object' ? configParam : {};\n\n    const localization = this.getLocalization(confirmConfig);\n\n    let confirmClass = `${CONFIRM_CLASS_PREFIX}-default`;\n    let confirmStyle = '';\n    const confirmAlertTheme = typeof confirmAlertThemeParam !== 'undefined' ? confirmAlertThemeParam : this.config.confirmAlertTheme;\n    if (confirmAlertTheme) {\n      confirmClass = confirmAlertTheme;\n    }\n    const parser = new UAParser();\n    if (!this.config.confirmAlertThemeVariant || this.config.confirmAlertThemeVariant === 'cleverpush-confirm-auto') {\n      if (parser.getOS().name === 'Mac OS') {\n        confirmClass += ` ${CONFIRM_CLASS_PREFIX}-mac`;\n      } else if (parser.getOS().name === 'Windows') {\n        confirmClass += ` ${CONFIRM_CLASS_PREFIX}-windows ${CONFIRM_CLASS_PREFIX}-chrome`;\n      }\n    } else {\n      confirmClass += ` ${this.config.confirmAlertThemeVariant}`;\n    }\n\n    if (parser.getBrowser().name === 'Firefox') {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-firefox`;\n    }\n    if (parser.getBrowser().name === 'Opera') {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-opera`;\n    }\n    if (parser.getBrowser().name === 'Safari') {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-safari`;\n    }\n    if (parser.getBrowser().name === 'Chrome' || (parser.getBrowser().name === 'Edge' && isNewerEdge())) {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-chrome`;\n    } else if (parser.getBrowser().name === 'Edge') {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-edge`;\n    }\n\n    // hotfix\n    if (this.config.confirmAlertStyle && this.config.confirmAlertStyle.color) {\n      this.config.confirmAlertThemeTextColor = this.config.confirmAlertStyle.color;\n    }\n\n    if (this.config.confirmAlertThemeBackgroundColor) {\n      confirmStyle += `background-color: ${this.config.confirmAlertThemeBackgroundColor};`;\n      if (this.config.confirmAlertThemeTextColor) {\n        confirmStyle += `color: ${this.config.confirmAlertThemeTextColor};`;\n      }\n    } else if (this.config.confirmAlertThemeBackground) {\n      confirmClass += (` ${this.config.confirmAlertThemeBackground}`);\n    }\n\n    if (this.config.confirmAlertHideChannelIcon) {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-hide-channel-icon`;\n    }\n    if (this.config.confirmAlertHideArrow) {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-hide-arrow`;\n    }\n\n    if (this.config.env === 'PREVIEW') {\n      confirmClass += ` ${CONFIRM_CLASS_PREFIX}-preview`;\n    }\n\n    if (this.config.confirmAlertCloseButton) {\n      confirmClass += ' cleverpush-confirm-with-close';\n    }\n\n    // add id to confirm class\n    confirmClass += ` ${CONFIRM_CLASS_PREFIX}-${this.id}`;\n\n    let topicSelection = '';\n    if (!confirmConfig.topicsLayer || this.withTopics) {\n      if (this.config.topicsTemplateFunction) {\n        topicSelection = `<div class=\"cleverpush-topics ${CONFIRM_CLASS_PREFIX}-topics\"></div>`;\n      } else if (this.channelTopics && this.channelTopics.length && !this.config.confirmAlertHideChannelTopics) {\n        let topics = this.channelTopics.filter((topic) => !topic.parentTopic);\n        if (confirmConfig && confirmConfig.parentTopic) {\n          topics = this.channelTopics.filter((topic) => topic.parentTopic === confirmConfig.parentTopic);\n        }\n\n        topicSelection += `<div class=\"cleverpush-topics ${CONFIRM_CLASS_PREFIX}-topics\">`;\n        topics.sort((a, b) => a.sort - b.sort).forEach((topic) => {\n          const topicName = charsetEscape(topic.name);\n          const topicDescription = topic.description ? `<div class=\"cleverpush-topic-description\">${charsetEscape(topic.description)}</div>` : '';\n          const childTopics = this.channelTopics.filter((childTopic) => childTopic.parentTopic === topic._id);\n\n          topicSelection += `<div><div class=\"${childTopics.length ? 'topic-has-children' : ''}\"><label style=\"${this.config.confirmAlertThemeTextColor ? (`color: ${this.config.confirmAlertThemeTextColor};`) : ''}\"><input type=\"${this.config.confirmAlertRadioButtonTopics || confirmConfig.topicsRadioButtons ? 'radio' : 'checkbox'}\" name=\"topics[]\" value=\"${topic._id}\" ${topicChecked(topic, this.subscribedTopics) ? 'checked' : ''} ${topic.childTopicsRequired ? ' data-child-topics-required=\"true\"' : ''}><div>${topicName}${topicDescription}</div></label></div></div>`;\n          if (childTopics.length) {\n            childTopics.forEach((childTopic) => {\n              const childTopicName = charsetEscape(childTopic.name);\n\n              const childInputType = this.config.confirmAlertRadioButtonTopics || topic.childTopicsRadioButtons ? 'radio' : 'checkbox';\n\n              topicSelection += `<div class=\"topic-child\" data-parent-topic=\"${topic._id}\" style=\"margin-left: 20px; font-size: 90%; ${!topicChecked(topic, this.subscribedTopics) ? 'display: none;' : ''}\"><label><input type=\"${childInputType}\" name=\"topics[]\" value=\"${childTopic._id}\" ${topicChecked(topic, this.subscribedTopics) && topicChecked(childTopic, this.subscribedTopics) ? 'checked' : ''}> ${childTopicName}</label></div>`;\n            });\n          }\n        });\n        topicSelection += '</div>';\n      }\n    }\n\n    let parentContainer;\n    if (this.config.appendConfirmBoxTo) {\n      parentContainer = document.querySelector(this.config.appendConfirmBoxTo);\n    }\n    if (!parentContainer) {\n      if (this.config.appendConfirmBoxTo) {\n        log.error('appendConfirmBoxTo: container not found. Falling back to default.');\n      }\n      parentContainer = document.body;\n    } else {\n      confirmClass += 'cleverpush-confirm-static';\n    }\n\n    const showLinks = true;\n    if (!this.withTopics && (window.parent.location.protocol === 'https:' || window.parent.location.hostname === 'localhost')) {\n      let isNativeBox = (\n        confirmAlertThemeParam\n        && confirmAlertThemeParam !== `${CONFIRM_CLASS_PREFIX}-default ${CONFIRM_CLASS_PREFIX}-default-native`\n        && confirmAlertThemeParam !== `${CONFIRM_CLASS_PREFIX}-backdrop-text ${CONFIRM_CLASS_PREFIX}-backdrop-text-native`\n      );\n      // if user does not need to accept native browser prompt -> show topics in first step\n      if (!isNativeBox && typeof window.Notification !== 'undefined' && window.Notification.permission === 'granted') {\n        isNativeBox = true;\n      }\n      log.debug('isNativeBox', isNativeBox);\n\n      if (this.config.confirmAlertSelectTopicsLater) {\n        topicSelection = '';\n      } else if (this.config.showConfirmAlert && this.config.isSafari_12_1) {\n        if (isNativeBox) {\n          topicSelection = '';\n        }\n      } else if (this.config.showConfirmAlert) {\n        const canHideTopics = this.config.confirmAlertNativeTheme && this.config.confirmAlertNativeTheme !== 'cleverpush-confirm-default';\n        if (isNativeBox) {\n          // links were already shown on first confirm box\n          // showLinks = false;\n\n          if (canHideTopics && (this.config.showConfirmAlertMobile || this.config.confirmAlertSelectTopicsLaterDisabled)) {\n            // show topics only on 1st box (mobile)\n            topicSelection = '';\n          }\n        } else if (canHideTopics && !this.config.showConfirmAlertMobile && !this.config.confirmAlertSelectTopicsLaterDisabled) {\n          // show topics only on 2nd box (desktop)\n          topicSelection = '';\n        }\n      } else if (isNativeBox && this.config.confirmAlertSelectTopicsLater && this.config.ownDomain) {\n        topicSelection = '';\n      }\n\n      if (isNativeBox) {\n        localization.title = localization.nativeTitle || localization.title || '';\n        localization.info = localization.nativeText || localization.info || '';\n      }\n    }\n\n    if (this.facebookEnabled && !this.config.facebookButtonOptIn) {\n      if (this.config.facebookDoubleOptIn && !this.facebookDoubleOptInConfirmed) {\n        // add the facebook confirm checkbox to topic selection (if double optin enabled)\n        topicSelection += `\n        <div style=\"margin-top: 15px; margin-bottom: 0; font-weight: bold;\" class=\"${CONFIRM_CLASS_PREFIX}-messenger-title cleverpush-topics ${CONFIRM_CLASS_PREFIX}-topics\">Facebook Messenger</div>\n        <div class=\"cleverpush-topics ${CONFIRM_CLASS_PREFIX}-topics\"><div style=\"margin-top: 5px;\"><label style=\"line-height: 1.5;\"><input type=\"checkbox\" id=\"cleverpush-facebook-checkbox\"> Ich möchte den Facebook-Newsletter und akzeptiere die <a href=\"${this.config.privacyPolicyUrl}\" target=\"_blank\">Datenschutzerklärung</a></label></div></div>`;\n      }\n\n      // add the messenger checkbox to topic selection\n      topicSelection += `<div class=\"fb-messenger-checkbox-wrap\"><div class=\"fb-messenger-checkbox\" origin=\"${location.origin}\" page_id=\"${this.config.facebookPageId}\" messenger_app_id=\"${this.config.facebookAppId}\" user_ref=\"${this.facebookUserRef}\" prechecked=\"true\" allow_login=\"true\" size=\"large\" style=\"margin-top: 10px; margin-left: -14px;\"></div></div>`;\n    }\n\n    if (this.withTopics && !confirmConfig.customLocalization) {\n      confirmClass += ' cleverpush-topic-box';\n      localization.title = charsetEscape(this.config.confirmAlertSelectTopicsLaterTitle) || translate('confirm.selectTopics') || localization.title;\n      localization.info = '';\n      localization.allow = this.config.confirmAlertSelectTopicsSaveText || translate('panel.save');\n    }\n\n    const infoStyle = `${this.config.confirmAlertThemeTextColor ? (`color: ${this.config.confirmAlertThemeTextColor};`) : ''} ${this.config.confirmAlertStyle && this.config.confirmAlertStyle.fontSize ? (`font-size: ${this.config.confirmAlertStyle.fontSize}px !important;`) : ''}`;\n    const brandingLinks = showLinks ? `<div class=\"cleverpush-confirm-branding\"><span>${this.getBrandingLinks()}</span></div>` : '';\n    const topbarArrow = confirmAlertThemeParam === 'cleverpush-confirm-topbar cleverpush-confirm-topbar-native' ? '<div class=\"cleverpush-confirm-topbar-arrow\"></div>' : '';\n    const closeButton = this.config.confirmAlertCloseButton ? '<button type=\"button\" class=\"cleverpush-confirm-hide\">&times;</button>' : '';\n    const iconClass = `cleverpush-confirm-icon${this.config.confirmAlertRoundChannelIcon ? ' cleverpush-confirm-icon-round' : ''}`;\n    const textStyle = this.config.confirmAlertThemeTextColor ? (`color: ${this.config.confirmAlertThemeTextColor};`) : '';\n    const titleStyle = this.config.confirmAlertThemeTitleColor ? (`color: ${this.config.confirmAlertThemeTitleColor};`) : '';\n    const allowButtonStyleInline = `${this.config.confirmAlertThemeButtonTextColor ? (`color: ${this.config.confirmAlertThemeButtonTextColor};`) : ''} ${this.config.confirmAlertThemeButtonBackgroundColor ? (`border-color: transparent !important; background: none; background-color: ${this.config.confirmAlertThemeButtonBackgroundColor};`) : ''}`;\n\n    let moreInfo = '';\n    if (this.config.alertMoreInformationEnabled && localization.moreInfo && localization.moreButton) {\n      let linkColor = this.config.confirmAlertThemeLinkColor;\n      if (this.config.confirmAlertLinkStyle && this.config.confirmAlertLinkStyle.color) {\n        linkColor = this.config.confirmAlertLinkStyle.color;\n      }\n      moreInfo = `\n      <div style=\"display: none\" class=\"cleverpush-confirm-more-text cleverpush-confirm-info\">\n        ${localization.moreInfo}\n      </div>\n      <div class=\"cleverpush-confirm-branding\">\n        <a href=\"#\" style=\"${linkColor ? (`color: ${linkColor} !important`) : ''}\" class=\"cleverpush-confirm-more-btn\">${localization.moreButton}</a>\n      </div>\n      `;\n    }\n\n    const confirm = createNode(`\n      <div class=\"${CONFIRM_CLASS_PREFIX} ${confirmClass}\" style=\"${confirmStyle}\">\n        <div class=\"${CONFIRM_CLASS_PREFIX}-caret ${CONFIRM_CLASS_PREFIX}-caret-top\" style=\"display: none; border-bottom-color: ${this.config.confirmAlertThemeBackgroundColor}\"></div>\n\n        <div class=\"${CONFIRM_CLASS_PREFIX}-caret ${CONFIRM_CLASS_PREFIX}-caret-bottom\" style=\"display: none; border-top-color: ${this.config.confirmAlertThemeBackgroundColor}\"></div>\n\n        ${closeButton}\n\n        <div class=\"${CONFIRM_CLASS_PREFIX}-wrap\">\n          ${topbarArrow}\n\n          <div class=\"${iconClass}\"><img src=\"${this.config.channelIcon}\"></div>\n\n          <div class=\"${CONFIRM_CLASS_PREFIX}-text\" style=\"${textStyle}\">\n            <span class=\"${CONFIRM_CLASS_PREFIX}-title\" style=\"${titleStyle}\">${localization.title}</span>\n            <p class=\"${CONFIRM_CLASS_PREFIX}-info\" style=\"${infoStyle}\">${localization.info}</p>\n            ${moreInfo}\n            ${brandingLinks}\n            ${topicSelection}\n          </div>\n\n          <div class=\"cleverpush-clearfix cleverpush-clearfix-bottom\">\n            <div class=\"${CONFIRM_CLASS_PREFIX}-buttons\">\n              <button class=\"${CONFIRM_CLASS_PREFIX}-btn ${CONFIRM_CLASS_PREFIX}-btn-deny\">${localization.deny}</button>\n              <button class=\"${CONFIRM_CLASS_PREFIX}-btn ${CONFIRM_CLASS_PREFIX}-btn-allow\" style=\"${allowButtonStyleInline}\">${localization.allow}</button>\n            </div>\n            <div class=\"cleverpush-clearfix\"></div>\n          </div>\n\n          ${localization.confirmInfo ? `\n            <div class=\"${CONFIRM_CLASS_PREFIX}-bottom-info\" style=\"display: none;\">\n              <div class=\"${iconClass}\"><img src=\"${this.config.channelIcon}\"></div>\n              <div class=\"${CONFIRM_CLASS_PREFIX}-bottom-info-text\">${localization.confirmInfo}</div>\n              <div class=\"cleverpush-clearfix\"></div>\n            </div>\n          ` : ''}\n        </div>\n      </div>\n    `);\n\n    parentContainer.appendChild(confirm);\n\n    this.confirmBox = document.querySelector(`.${CONFIRM_CLASS_PREFIX}-${this.id}`);\n    if (this.confirmBox && typeof this.config.confirmAlertStyle === 'object') {\n      for (const property in this.config.confirmAlertStyle) {\n        if (this.config.confirmAlertStyle.hasOwnProperty(property)) {\n          this.confirmBox.style[property] = this.config.confirmAlertStyle[property] + (!isNaN(this.config.confirmAlertStyle[property]) ? 'px' : '');\n        }\n      }\n    }\n\n    this.confirmBoxTitle = document.querySelector(`.${CONFIRM_CLASS_PREFIX}-${this.id} .${CONFIRM_CLASS_PREFIX}-title`);\n    if (this.confirmBoxTitle && typeof this.config.confirmAlertTitleStyle === 'object') {\n      for (const property in this.config.confirmAlertTitleStyle) {\n        if (this.config.confirmAlertTitleStyle.hasOwnProperty(property)) {\n          this.confirmBoxTitle.style[property] = this.config.confirmAlertTitleStyle[property] + (!isNaN(this.config.confirmAlertTitleStyle[property]) ? 'px' : '');\n        }\n      }\n    }\n\n    // if only button background color is set OR button background color === allow button background color:\n    // -> unset button background color and set allow button background color\n    try {\n      const buttonStyle = this.config.confirmAlertButtonStyle || {};\n      const allowButtonStyle = this.config.confirmAlertAllowButtonStyle || {};\n      if (\n        buttonStyle.backgroundColor\n        && (\n          !allowButtonStyle.backgroundColor\n          || (this.config.confirmAlertAllowButtonStyle || {}).backgroundColor === buttonStyle.backgroundColor\n        )\n      ) {\n        (this.config.confirmAlertAllowButtonStyle || {}).backgroundColor = buttonStyle.backgroundColor;\n        delete buttonStyle.backgroundColor;\n      }\n      if (\n        buttonStyle.color\n        && (\n          !allowButtonStyle.color\n          || (this.config.confirmAlertAllowButtonStyle || {}).color === buttonStyle.color\n        )\n      ) {\n        (this.config.confirmAlertAllowButtonStyle || {}).color = buttonStyle.color;\n        delete (this.config.confirmAlertButtonStyle || {}).color;\n      }\n    } catch (ignored) { }\n\n    // fix margin left\n    if (\n      (this.cleverpush.config.customCss || '')\n        .replace(REGEX_NEW_LINES, '')\n        .replace(REGEX_SPACE, '')\n        .includes(\n          `.${CONFIRM_CLASS_PREFIX}-btn { width: 100% !important; }`\n            .replace(REGEX_NEW_LINES, '')\n            .replace(REGEX_SPACE, '')\n        )\n    ) {\n      if (!this.config.confirmAlertAllowButtonStyle) {\n        this.config.confirmAlertAllowButtonStyle = {};\n      }\n      this.config.confirmAlertAllowButtonStyle.marginLeft = '0px';\n    }\n\n    if (Object.keys(this.config.confirmAlertIconStyle || {}).length) {\n      const icon = this.confirmBox.querySelector(`.${CONFIRM_CLASS_PREFIX}-icon img`);\n      const style = this.config.confirmAlertIconStyle;\n      if (icon) {\n        if (style.width) {\n          icon.style.width = `${style.width}px`;\n          if (window.innerWidth >= 768) {\n            const text = this.confirmBox.querySelector(`.${CONFIRM_CLASS_PREFIX}-text`);\n            if (text) {\n              const margin = 15;\n              text.style.setProperty('width', `calc(100% - ${style.width + margin}px)`, 'important');\n            }\n          }\n        }\n        if (style.height) {\n          icon.style.height = `${style.height}px`;\n        }\n      }\n    }\n\n    this.allowButton = this.confirmBox.querySelector(`.${CONFIRM_CLASS_PREFIX}-btn-allow`);\n    if (this.allowButton) {\n      if (confirmConfig.topicsLayer) {\n        this.allowButton.addEventListener('click', (event) => this.onTopicsAllowClick(event, confirmConfig.parentTopic), true);\n      } else {\n        this.allowButton.addEventListener('click', this.onAllowClick.bind(this), true);\n      }\n      if (typeof this.config.confirmAlertButtonStyle === 'object') {\n        if (this.config.confirmAlertButtonStyle.backgroundColor && !this.config.confirmAlertButtonStyle.borderColor) {\n          this.config.confirmAlertButtonStyle.borderColor = 'transparent';\n        }\n        for (const property in this.config.confirmAlertButtonStyle) {\n          if (this.config.confirmAlertButtonStyle.hasOwnProperty(property)) {\n            this.allowButton.style.setProperty(camelCaseToDash(property), this.config.confirmAlertButtonStyle[property], 'important');\n          }\n        }\n      }\n      if (typeof this.config.confirmAlertAllowButtonStyle === 'object') {\n        for (const property in this.config.confirmAlertAllowButtonStyle) {\n          if (this.config.confirmAlertAllowButtonStyle.backgroundColor && !this.config.confirmAlertAllowButtonStyle.borderColor) {\n            this.config.confirmAlertAllowButtonStyle.borderColor = 'transparent';\n          }\n          if (this.config.confirmAlertAllowButtonStyle.hasOwnProperty(property)) {\n            this.allowButton.style.setProperty(camelCaseToDash(property), this.config.confirmAlertAllowButtonStyle[property], 'important');\n          }\n        }\n      }\n    }\n\n    this.denyButton = this.confirmBox.querySelector(`.${CONFIRM_CLASS_PREFIX}-btn-deny`);\n    if (this.denyButton) {\n      if (confirmConfig.topicsLayer) {\n        this.denyButton.addEventListener('click', (event) => this.onTopicsDenyClick(event, confirmConfig.parentTopic));\n      } else {\n        this.denyButton.addEventListener('click', this.onDenyClick.bind(this));\n      }\n      if (typeof this.config.confirmAlertButtonStyle === 'object') {\n        for (const property in this.config.confirmAlertButtonStyle) {\n          if (this.config.confirmAlertButtonStyle.hasOwnProperty(property)) {\n            this.denyButton.style.setProperty(camelCaseToDash(property), this.config.confirmAlertButtonStyle[property], 'important');\n          }\n        }\n      }\n    }\n\n    this.closeButton = this.confirmBox.querySelector(`.${CONFIRM_CLASS_PREFIX}-hide`);\n    if (this.closeButton) {\n      this.closeButton.addEventListener('click', this.onCloseClick.bind(this));\n\n      if (this.confirmBox && typeof this.config.confirmAlertStyle === 'object' && this.config.confirmAlertStyle.color) {\n        this.closeButton.style.color = this.config.confirmAlertStyle.color;\n      }\n    }\n\n    this.moreButton = this.confirmBox.querySelector(`.${CONFIRM_CLASS_PREFIX}-more-btn`);\n    if (this.moreButton) {\n      const moreDiv = this.confirmBox.querySelector(`.${CONFIRM_CLASS_PREFIX}-more-text`);\n      if (moreDiv) {\n        this.moreButton.addEventListener('click', (event) => {\n          event.preventDefault();\n          moreDiv.style.display = moreDiv.style.display === 'block' ? 'none' : 'block';\n        });\n      }\n    }\n\n    const topics = this.confirmBox.querySelectorAll('input[name=\"topics[]\"]');\n    for (let topicIndex = 0; topicIndex < topics.length; topicIndex += 1) {\n      topics[topicIndex].addEventListener('change', (e) => {\n        if (!this.confirmBox) {\n          this.confirmBox = document.querySelector(`.${CONFIRM_CLASS_PREFIX}-${this.id}`);\n        }\n        const childTopics = this.confirmBox.querySelectorAll(`.topic-child[data-parent-topic=\"${e.target.value}\"]`);\n        for (let childTopicIndex = 0; childTopicIndex < childTopics.length; childTopicIndex += 1) {\n          childTopics[childTopicIndex].style.display = e.target.checked ? 'block' : 'none';\n          const childTopicInput = childTopics[childTopicIndex].querySelector('input[type=\"checkbox\"], input[type=\"radio\"]');\n\n          const childTopic = (this.config.channelTopics || []).find((topic) => topic._id === childTopicInput.value);\n          if (!e.target.checked) {\n            childTopicInput.checked = false;\n          } else if (childTopic) {\n            childTopicInput.checked = topicChecked(childTopic, this.subscribedTopics);\n          }\n        }\n      });\n    }\n\n    if (this.config.topicsTemplateFunction && topicSelection) {\n      const topicsDiv = parentContainer.querySelector(`.${CONFIRM_CLASS_PREFIX} .${CONFIRM_CLASS_PREFIX}-topics`);\n      if (topicsDiv) {\n        try {\n          const templateFunc = eval(`(${this.config.topicsTemplateFunction})`);\n          if (typeof templateFunc === 'function') {\n            log.debug('calling templateFunc');\n            this.subscriptionManager.getTopics().then((selectedTopicIds) => {\n              templateFunc(topicsDiv, this.config, selectedTopicIds, 'confirm');\n            });\n          } else {\n            log.warn('typeof templateFunc is not function');\n          }\n        } catch (err) {\n          log.warn(err);\n        }\n      } else {\n        log.warn('.cleverpush-topics div not found');\n      }\n    }\n  }\n\n  show(subscribeCallback) {\n    logMethodCall('showConfirmBox');\n\n    if (typeof subscribeCallback === 'function') {\n      this.subscribeCallback = subscribeCallback;\n    }\n\n    if (this.visible) {\n      return;\n    }\n    this.visible = true;\n\n    this.appendConfirmBox();\n    this.showBackdrop();\n  }\n\n  setAutoHideBackdrop(autoHideBackdrop) {\n    this.autoHideBackdrop = autoHideBackdrop;\n  }\n}\n","export function topicChecked(topic, subscribedTopics) {\n  if (typeof subscribedTopics !== 'undefined' && subscribedTopics && subscribedTopics.length && (subscribedTopics || []).indexOf(topic._id) > -1) {\n    return true;\n  }\n  return !topic.defaultUnchecked || (topic.matchPathChecked && topic.matchPathChecked && (location.pathname && (new RegExp(topic.matchPathChecked)).test(location.pathname)));\n}\n"],"sourceRoot":""}